<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cudo.pixelviewer.operate.mapper.LayerMapper">


<!--    <select id="getLayerList" resultType="com.cudo.pixelviewer.vo.LayerVo">-->
    <select id="getLayerList" resultType="Map">
        SELECT layer_id AS layerId, preset_id AS presetId, screen_id AS screenId, layer_nm AS layerNm
             , pos_x AS posX, pos_y AS posY, width AS width, height AS height, ord AS ord
             , sub_first_en AS subFirstEn, sub_second_en AS subSecondEn
             , ex_video_en AS exVideoEn, weather_en AS weatherEn, air_en AS airEn
        FROM Layers AS L
    </select>
    <select id="getLayerListPlayList" resultType="Integer">
        SELECT playlist_id
        FROM Playlists
        where layer_id = #{layerId}
    </select>

<!--    <select id="getLayer" resultType="com.cudo.pixelviewer.vo.LayerVo">-->
    <select id="getLayer" resultType="Map">
        SELECT L.layer_id AS layerId, L.preset_id AS presetId, L.screen_id AS screenId, L.layer_nm AS layerNm
             , L.pos_x AS posX, L.pos_y AS posY, L.width AS width, L.height AS height, L.ord AS ord
             , L.sub_first_en AS subFirstEn, L.sub_second_en AS subSecondEn
             , L.ex_video_en AS exVideoEn, L.weather_en AS weatherEn, L.air_en AS airEn
        FROM Layers AS L
        WHERE L.layer_id = #{layerId}
    </select>
    <select id="getLayerLayerObject" resultType="Map">
        SELECT *
        FROM LayerObjects
        WHERE layer_id = #{layerId}
    </select>
    <select id="getLayerObjectExternalVideo" resultType="Map">
        SELECT pos_x AS posX, pos_y AS posY, ord AS ord, rtsp_url AS rtspUrl,  video_nm AS videoNm, ex_video_id AS exVideoId, width AS width, video_format AS videoFormat, type AS type, object_id AS objectId, height AS height, update_date AS updateDate
        FROM ExternalVideo
        WHERE object_id = #{objectId}
    </select>
    <select id="getLayerObjectExternalInfo" resultType="Map">
        SELECT ord AS ord, underline AS underline, font_nm AS fontNm, font_size AS fontSize, forecolor AS forecolor, bold AS bold, type AS type, object_id AS objectId, italic AS italic, pos_y AS posY, ex_info_id AS exInfoId, pos_x AS posX, image_layout AS imageLayout, width AS width, height AS height, image_list AS imageList
        FROM External_Info
        WHERE object_id = #{objectId}
    </select>
    <select id="getLayerObjectExternalSubtitle" resultType="Map">
        SELECT *
        FROM Subtitles
        WHERE object_id = #{objectId}
    </select>


    <select id="postLayerValid" resultType="int">
        SELECT count(layer_id)
        FROM Layers
        WHERE layer_nm = #{layerNm}
            AND rowsize = #{rowsize}
            AND columnsize = #{columnsize}
    </select>
    <insert id="postLayer" parameterType="Map" useGeneratedKeys="true" keyColumn="layer_id"
            keyProperty="layerId">
        INSERT INTO Layers
        (
            screen_id, preset_id, layer_nm, pos_x, pos_y, width, height, ord, sub_first_en, sub_second_en, ex_video_en, weather_en, air_en
        )
        VALUES
        (
            #{screenId}, #{presetId}, #{layerNm}, 0, 0, 0, 0, 0, false, false, false, false, false
        )
    </insert>

    <select id="deleteLayerValid" resultType="int">
        SELECT COUNT(layer_id)
        FROM Layers
        WHERE Layers.layer_id = #{layerId}
    </select>
    <update id="deleteLayer">
        DELETE L.*, LO.*, EV.*, EI.*, S.*
        FROM Layers AS L
            LEFT JOIN LayerObjects as LO ON LO.layer_id = L.layer_id
            LEFT JOIN ExternalVideo as EV ON EV.layer_id = L.layer_id
            LEFT JOIN External_Info as EI ON EI.layer_id = L.layer_id
            LEFT JOIN Subtitles as S ON S.layer_id = L.layer_id
        WHERE L.layer_id = #{layerId}
    </update>

    <select id="putLayerValid" resultType="int">
        SELECT COUNT(layer_id)
        FROM Layers
        WHERE Layers.layer_id = #{layerId}
    </select>
    <update id="putLayer">
        UPDATE Layers
        SET preset_id = #{presetId}, screen_id = #{screenId}
            , layer_nm = #{layerNm}, pos_x = #{posX}, pos_y = #{posY}
            , width = #{width}, height = #{height}, ord = #{ord}
            , sub_first_en = #{subFirstEn}, sub_second_en = #{subSecondEn}
            , ex_video_en = #{exVideoEn}, weather_en = #{weatherEn}, air_en = #{airEn}
        WHERE Layers.layer_id = #{layerId}
    </update>

</mapper>